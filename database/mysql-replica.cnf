# MySQL Replica (Secondary) Configuration
# For use with MySQL 8.0+

[mysqld]
# Server identification (must be unique)
server-id = 2
log-bin = /var/log/mysql/mysql-bin.log
binlog_format = ROW
relay-log = /var/log/mysql/relay-bin
relay-log-index = /var/log/mysql/relay-bin.index

# Read-only mode (except for replication thread)
read_only = 1
super_read_only = 1

# Replication settings
replicate-do-db = voting_db
slave_parallel_workers = 4
slave_parallel_type = LOGICAL_CLOCK

# InnoDB settings
innodb_flush_log_at_trx_commit = 2
innodb_buffer_pool_size = 1G
innodb_log_file_size = 256M

# Connection settings
max_connections = 200
max_allowed_packet = 64M

# Character set
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# Logging
log_error = /var/log/mysql/error.log
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow-query.log
long_query_time = 2

# Performance schema
performance_schema = ON

# GTID-based replication
gtid_mode = ON
enforce_gtid_consistency = ON

# Semi-synchronous replication (optional)
# plugin-load = "rpl_semi_sync_slave=semisync_slave.so"
# rpl_semi_sync_slave_enabled = 1

# Skip errors (use with caution in production)
# slave_skip_errors = 1062,1032
